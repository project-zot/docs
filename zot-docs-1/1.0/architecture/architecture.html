<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Architecture :: Zot Docs</title>
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
    <link rel="icon" href="../../../favicon.ico" type="image/x-icon">  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item navbar-logo" href="../../.."></a>
      <a class="navbar-item" href="../../..">Zot Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://zotregistry.io/">Home</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="zot-docs-1" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../toc/zot-toc.html">Zot Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../toc/zot-toc.html">Documentation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">General</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../general/zot-concepts.html">Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../general/artifacts.html">Released Artifacts for zot</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="architecture.html">Architecture</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">User Guides</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../user-guides/user-guide-datapath.html">Push and Pull Image Content</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../admin-guide/admin-guide.html">Zot Administrator Guide</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../developer-guide/developer-guide.html">Zot Developer Guide</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installation Guides</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install-guides/install-guide-linux.html">Installing zot on Bare Metal Linux</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install-guides/install-guide-k8s.html">Installing zot with Kubernetes and Helm</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Articles</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kb/building-ci-cd-pipeline.html">Building an OCI-native Container Image CI/CD Pipeline</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kb/authn-authz.html">User Authentication and Authorization with zot</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kb/security-posture.html">zot Security Posture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kb/storage.html">Storage Planning with zot</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kb/clustering.html">zot Clustering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kb/benchmarking-with-zb.html">Benchmarking zot with zb</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Zot Documentation</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../toc/zot-toc.html">Zot Documentation</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../toc/zot-toc.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../toc/zot-toc.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../toc/zot-toc.html">Zot Documentation</a></li>
    <li><a href="architecture.html">Architecture</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Architecture</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Revised: 2022-10-26</p>
</div>
<div class="paragraph">
<p><code>zot</code> is an OCI-native container image registry. This document discusses the design goals, the overall architecture, and the design choices made in the implementation of the design goals.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_design_goals"><a class="anchor" href="#_design_goals"></a><a class="link" href="#_design_goals">Design Goals</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_oci_first"><a class="anchor" href="#_oci_first"></a><a class="link" href="#_oci_first">OCI-first</a></h3>
<div class="ulist">
<ul>
<li>
<p>Strictly conforms to the <a href="https://github.com/opencontainers/distribution-spec">OCI Distribution Specification</a></p>
<div class="paragraph">
<p><code>zot</code> intends to be <strong>the primary</strong> reference implementation for the OCI Distribution Specification. In fact, <code>zot</code> does not support any other vendor protocol or specification.</p>
</div>
</li>
<li>
<p>Storage layout follows the <a href="https://github.com/opencontainers/image-spec">OCI Image Specification</a></p>
<div class="paragraph">
<p>The default and only supported storage layout is the OCI Image Layout. The implications of this choice are that any OCI image layout can be served by <code>zot</code> and conversely, <code>zot</code> converts data on-the-wire into an OCI image layout.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_single_binary_model"><a class="anchor" href="#_single_binary_model"></a><a class="link" href="#_single_binary_model">Single binary model</a></h3>
<div class="paragraph">
<p><code>zot</code> is a single binary image with all features included so that deployment is extremely simple in various environments, including bare-metal, cloud, and embedded devices. Behavior is controlled by a single configuration file.</p>
</div>
</div>
<div class="sect2">
<h3 id="_enable_only_what_you_need"><a class="anchor" href="#_enable_only_what_you_need"></a><a class="link" href="#_enable_only_what_you_need">Enable Only What You Need</a></h3>
<div class="paragraph">
<p>A clear separation exists between (1) the core OCI-compliant HTTP APIs and storage functionality, and (2) other add-on features modeled as <strong>extensions</strong>. The extension features can be selectively enabled both at build-time and run-time.</p>
</div>
<div class="paragraph">
<p>For more information, see "Conditional Builds" in <a href="../kb/security-posture.html#_conditional_builds" class="xref page">zot Security Posture</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overall_architecture"><a class="anchor" href="#_overall_architecture"></a><a class="link" href="#_overall_architecture">Overall Architecture</a></h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="_images/504567.jpg" alt="200">
</div>
</div>
<div class="sect2">
<h3 id="_interaction"><a class="anchor" href="#_interaction"></a><a class="link" href="#_interaction">Interaction</a></h3>
<div class="paragraph">
<p>External interaction with <code>zot</code> consists of the following two types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Client-initiated data or meta-data queries</p>
</li>
<li>
<p>Admin-initiated configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All client-side interaction occurs over HTTP APIs. The core data path queries are governed by the <a href="https://github.com/opencontainers/distribution-spec">OCI Distribution Specification</a>. All additional meta-data queries are handled based on the setting of the <code>search</code> extension:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the <code>search</code> extension is enabled, enhanced registry searching and filtering is supported, using graphQL. A database is maintained by <code>zot</code> to efficiently answer complex queries on data stored in the database.</p>
</li>
<li>
<p>If the <code>search</code> extension is not enabled, basic queries are supported using the core APIs. These queries are less efficient and search actual storage, which is limited in content.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_configuration"><a class="anchor" href="#_configuration"></a><a class="link" href="#_configuration">Configuration</a></h3>
<div class="paragraph">
<p>A single configuration file governs <code>zot</code> instance behavior. An exception can be made for security concerns, wherein configuration items containing sensitive credentials can be stored in separate files referenced by the main configuration file. Using separate files allows stricter permissions to be enforced on those files if stored locally. Also, modeling as external files allows for storing <a href="https://kubernetes.io/docs/concepts/configuration/secret/">Kubernetes Secrets</a>.</p>
</div>
<div class="paragraph">
<p>The configuration file is divided into sections for <code>http</code>, <code>storage</code>, <code>log</code>, and <code>extension</code>, governing the behavior of the respective components.</p>
</div>
</div>
<div class="sect2">
<h3 id="_authentication_and_authorization"><a class="anchor" href="#_authentication_and_authorization"></a><a class="link" href="#_authentication_and_authorization">Authentication and Authorization</a></h3>
<div class="paragraph">
<p>A robust set of authentication and authorization options are supported natively in <code>zot</code>. These controls are enforced before access is allowed into the storage layer.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="../kb/authn-authz.html" class="xref page">User Authentication and Authorization with zot</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_storage_driver_support"><a class="anchor" href="#_storage_driver_support"></a><a class="link" href="#_storage_driver_support">Storage Driver Support</a></h3>
<div class="paragraph">
<p><code>zot</code> supports any modern local filesystem. Remote filesystems, such as AWS S3 or any AWS S3-compatible storage system, are supported. Additional driver support is planned in the roadmap.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Deduplication is supported for both local and remote filesystems, but deduplication requires a filesystem with hard-link support.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information, see <a href="../kb/storage.html" class="xref page">Storage Planning with zot</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_security_scanning"><a class="anchor" href="#_security_scanning"></a><a class="link" href="#_security_scanning">Security Scanning</a></h3>
<div class="paragraph">
<p><code>zot</code> integrates with the <a href="https://github.com/aquasecurity/trivy"><code>trivy</code></a> security scanner to scan container images for vulnerabilities. The database is kept current by periodically downloading any vulnerability database updates at a configurable interval. The user remains agnostic of the actual scanner implementation, which may change over time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_extensions"><a class="anchor" href="#_extensions"></a><a class="link" href="#_extensions">Extensions</a></h3>
<div class="paragraph">
<p>Wherever applicable, extensions can be dynamically discovered using the <a href="https://github.com/opencontainers/distribution-spec/tree/main/extensions">extensions support</a> of the OCI Distribution Specification. The following extensions are currently supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Search</strong></p>
<div class="paragraph">
<p>One of the key functions of a container image registry (which is essentially a graph of blobs) is the ability to perform interesting image and graph traversal queries. The user interacts with the <strong>search</strong> extension via a graphQL endpoint. The schema is published with every release.</p>
</div>
<div class="paragraph">
<p>Examples of queries are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Does an image exist?"</p>
</li>
<li>
<p>"What is its size?"</p>
</li>
<li>
<p>"Does an image depend on this image via its layers?"</p>
</li>
<li>
<p>"What vulnerabilities exist in an image or its dependent images?"</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Sync</strong></p>
<div class="paragraph">
<p>You can deplay a local mirror pointing to an upstream <code>zot</code> instance with various container image download policies, including on-demand and periodic downloads. The <strong>sync</strong> function is useful to avoid overwhelming the upstream instance, or if the upstream instance has rate-limited access.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>docker.io</code> is supported as an upstream mirror.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><strong>Lint</strong></p>
<div class="paragraph">
<p>The <strong>lint</strong> extension helps to avoid image compliance issues by enforcing certain policies about the image or the image metadata. Currently, <strong>lint</strong> can  check an uploaded image to enforce the presence of required annotations such as the author or the license.</p>
</div>
</li>
<li>
<p><strong>Scrub</strong></p>
<div class="paragraph">
<p>Although container images are content-addressable with their SHA256 checksums, and validations are performed during storage and retrieval, it is possible that bit-rot sets in when not in use. The <strong>scrub</strong> extension actively scans container images in the background to proactively detect errors.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_background_tasks"><a class="anchor" href="#_background_tasks"></a><a class="link" href="#_background_tasks">Background Tasks</a></h3>
<div class="paragraph">
<p>Several periodic tasks occur in the registry, such as garbage collection, sync mirroring, and scrubbing.  A task scheduler handles these tasks in the background, taking care not to degrade or interrupt foreground tasks running in the context of HTTP APIs.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
